var APP=APP||function(){};APP.Main=function(){function a(){APP.HandleImage.init(),APP.CoverLayer.init()}var b;return console.log("Ponty!"),{getInstance:function(){return b||(b=a()),b}}}(),APP.HandleImage=function(){function a(){t.ondragover=function(){return n.hasClass("image-not-uploaded")?(n.addClass("in"),!1):void 0},t.ondragend=function(){return n.hasClass("image-not-uploaded")?(n.removeClass("in"),!1):void 0},t.ondrop=function(a){return n.hasClass("image-not-uploaded")?(a.preventDefault&&a.preventDefault(),n.removeClass("in"),j=a.dataTransfer.files,b(j),!1):void 0},w.on({change:function(a){var c=a.target.files;b(c)}}),z.on({click:g}),s.on({click:function(){location.reload()}}),A.on({keyup:function(a){13!==parseInt(a.which,10)||z.hasClass("button--hidden")||z.trigger("click")}})}function b(a){if(void 0!==a[0]&&u[a[0].type]===!0){var b=new FileReader;b.onload=function(a){var b=new Image;b.id="selected-image",b.src=a.target.result,p.append(b),o.addClass("hidden"),p.removeClass("hidden"),n.removeClass("image-not-uploaded"),m=$("#selected-image"),l=Math.floor((m.width()-v)/2),offsetY=0,m.on("load",function(){v>m.height()&&(v=m.height()-10,x.width=v,x.height=v),m.Jcrop({bgFade:!0,bgOpacity:.2,minSize:[v,v],setSelect:[l,offsetY,v,v],aspectRatio:1,onSelect:c},function(){k=this}),h()})},b.readAsDataURL(a[0])}}function c(a){y.x=a.x,y.y=a.y,y.x2=a.x2,y.y2=a.y2,y.w=a.w,y.h=a.h}function d(){var a=x.getContext("2d"),b=m,c=b[0],d=x.width-173;imgW=0===c.width?b.attr("width"):c.width,imgH=0===c.height?b.attr("height"):c.height,ratioY=imgH/b.height(),ratioX=imgW/b.width(),getX=Math.floor(y.x*ratioX),getY=Math.floor(y.y*ratioY),getWidth=Math.floor(y.w*ratioX),getHeight=Math.floor(y.h*ratioY),a.drawImage(c,getX,getY,getWidth,getHeight,0,0,Math.floor(v),Math.floor(v)),i("img/matra-kempo-se-watermark.png",a,d,d)}function e(a){r.attr("href",a.toDataURL())}function f(){q.prepend('<img src="'+x.toDataURL()+'" class="canvas-preview blk" width="'+x.width+'" height="'+x.height+'">')}function g(){d(),p.addClass("hidden"),q.removeClass("hidden"),z.addClass("button--hidden")}function h(){z.removeClass("button--hidden")}function i(a,b,c,d){var g=new Image;g.onload=function(){b.drawImage(g,c,d),f(),e(x)},g.src=a}var j,k,l,m,k,n=$("[data-container]"),o=n.find("[data-upload]"),p=n.find("[data-crop]"),q=n.find("[data-canvas]"),r=n.find("[data-image-link]"),s=n.find("[data-reload]"),t=$("[data-container]")[0],u={"image/png":!0,"image/jpeg":!0},v=320,w=$("#upload"),x=document.getElementById("resize-canvas"),y={},z=$("[data-crop-btn]"),A=$("body");return{init:a}}(),APP.CoverLayer=function(){function a(){c.on({"load.removeLoading":function(){b.fadeOut(250)}})}var b=$("[data-loading-layer]"),c=$(window);return{init:a}}();